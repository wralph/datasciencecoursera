## Codeboox for the script "run_analysis.R" provided in this github repository

Script Author: Ralph Waldenmaier

Description (provided by the JHU on coursera):
The purpose of this project is to demonstrate your ability to collect, work with, and clean a data set. 
The goal is to prepare tidy data that can be used for later analysis. You will be graded by your peers 
on a series of yes/no questions related to the project. You will be required to submit: 1) a tidy data 
set as described below, 2) a link to a Github repository with your script for performing the analysis, 
and 3) a code book that describes the variables, the data, and any transformations or work that you 
performed to clean up the data called CodeBook.md. You should also include a README.md in the repo 
with your scripts. This repo explains how all of the scripts work and how they are connected.  

One of the most exciting areas in all of data science right now is wearable computing - see for example this article . Companies like Fitbit, Nike, and Jawbone Up are racing to develop the most advanced algorithms to attract new users. The data linked to from the course website represent data collected from the accelerometers from the Samsung Galaxy S smartphone. A full description is available at the site where the data was obtained: 

http://archive.ics.uci.edu/ml/datasets/Human+Activity+Recognition+Using+Smartphones 

Here are the data for the project: 

https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip 

 You should create one R script called run_analysis.R that does the following. 
Merges the training and the test sets to create one data set.
Extracts only the measurements on the mean and standard deviation for each measurement. 
Uses descriptive activity names to name the activities in the data set
Appropriately labels the data set with descriptive variable names. 
From the data set in step 4, creates a second, independent tidy data set with the average of each variable for each activity and each subject.



### Required packages
First of all we need to ensure that the required packages for this script are installed and loaded. 
In this script data.table and reshape2 is used.
```r
if (!require("data.table")) {
  install.packages("data.table")
}

if (!require("reshape2")) {
  install.packages("reshape2")
}

require("data.table")
require("reshape2")
```

### Define the name of the zipped dataset
```r
zippedDataset <- "dataset.zip"
```

Now in case the zipped dataset is not existing, it needs to be downloaded to be used later on.

```r
if(!file.exists(zippedDataset))
{
  #### download dataset
  zip <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
  download.file(zip, zippedDataset)
  rm(zip)  
}
```

## 1. Merges the training and the test sets to create one data set.

The first operations are performed on the previously downloaded dataset. In this step, we want to read the required
data and merge them together.


### Obtaining feature information

The description of the features is loaded to be used for a later labelling.
The whole script is not working on an unzipped version of the dataset but does that on-the-fly using unz.

```r
features <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/features.txt"), 
                                  col.names=c("id", "feature"), 
                                  stringsAsFactors=FALSE))

```

The structure is as following.
```r
str(features)
Classes ‘data.table’ and 'data.frame':	561 obs. of  2 variables:
 $ id     : int  1 2 3 4 5 6 7 8 9 10 ...
 $ feature: chr  "tBodyAcc-mean()-X" "tBodyAcc-mean()-Y" "tBodyAcc-mean()-Z" "tBodyAcc-std()-X" ...
 - attr(*, ".internal.selfref")=<externalptr> 
```
                                  
								  
### Reading test data

First the test data will be obtained and prepared for merge

#### Reading measurements

```r
data.test.x <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/test/X_test.txt")))
```
```r
str(data.test.x)
Classes ‘data.table’ and 'data.frame':	561 obs. of  2 variables:
 $ id     : int  1 2 3 4 5 6 7 8 9 10 ...
 $ feature: chr  "tBodyAcc-mean()-X" "tBodyAcc-mean()-Y" "tBodyAcc-mean()-Z" "tBodyAcc-std()-X" ...
 - attr(*, ".internal.selfref")=<externalptr> 
> data.test.x <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/test/X_test.txt")))
> str(data.test.x)
Classes ‘data.table’ and 'data.frame':	2947 obs. of  561 variables:
 $ V1  : num  0.257 0.286 0.275 0.27 0.275 ...
 $ V2  : num  -0.0233 -0.0132 -0.0261 -0.0326 -0.0278 ...
 $ V3  : num  -0.0147 -0.1191 -0.1182 -0.1175 -0.1295 ...
 $ V4  : num  -0.938 -0.975 -0.994 -0.995 -0.994 ...
 $ V5  : num  -0.92 -0.967 -0.97 -0.973 -0.967 ...
 $ V6  : num  -0.668 -0.945 -0.963 -0.967 -0.978 ...
 $ V7  : num  -0.953 -0.987 -0.994 -0.995 -0.994 ...
 $ V8  : num  -0.925 -0.968 -0.971 -0.974 -0.966 ...
 $ V9  : num  -0.674 -0.946 -0.963 -0.969 -0.977 ...
 $ V10 : num  -0.894 -0.894 -0.939 -0.939 -0.939 ...
 $ V11 : num  -0.555 -0.555 -0.569 -0.569 -0.561 ...
 $ V12 : num  -0.466 -0.806 -0.799 -0.799 -0.826 ...
 $ V13 : num  0.717 0.768 0.848 0.848 0.849 ...
 $ V14 : num  0.636 0.684 0.668 0.668 0.671 ...
 $ V15 : num  0.789 0.797 0.822 0.822 0.83 ...
 $ V16 : num  -0.878 -0.969 -0.977 -0.974 -0.975 ...
 $ V17 : num  -0.998 -1 -1 -1 -1 ...
 $ V18 : num  -0.998 -1 -1 -0.999 -0.999 ...
 $ V19 : num  -0.934 -0.998 -0.999 -0.999 -0.999 ...
 $ V20 : num  -0.976 -0.994 -0.993 -0.995 -0.993 ...
 $ V21 : num  -0.95 -0.974 -0.974 -0.979 -0.967 ...
 $ V22 : num  -0.83 -0.951 -0.965 -0.97 -0.976 ...
 $ V23 : num  -0.168 -0.302 -0.618 -0.75 -0.591 ...
 $ V24 : num  -0.379 -0.348 -0.695 -0.899 -0.74 ...
 $ V25 : num  0.246 -0.405 -0.537 -0.554 -0.799 ...
 $ V26 : num  0.521 0.507 0.242 0.175 0.116 ...
 $ V27 : num  -0.4878 -0.1565 -0.115 -0.0513 -0.0289 ...
 $ V28 : num  0.4823 0.0407 0.0327 0.0342 -0.0328 ...
 $ V29 : num  -0.0455 0.273 0.1924 0.1536 0.2943 ...
 $ V30 : num  0.21196 0.19757 -0.01194 0.03077 0.00063 ...
 $ V31 : num  -0.1349 -0.1946 -0.0634 -0.1293 -0.0453 ...
 $ V32 : num  0.131 0.411 0.471 0.446 0.168 ...
 $ V33 : num  -0.0142 -0.3405 -0.5074 -0.4195 -0.0682 ...
 $ V34 : num  -0.106 0.0776 0.1885 0.2715 0.0744 ...
 $ V35 : num  0.0735 -0.084 -0.2316 -0.2258 0.0271 ...
 $ V36 : num  -0.1715 0.0353 0.6321 0.4164 -0.1459 ...
 $ V37 : num  0.0401 -0.0101 -0.5507 -0.2864 -0.0502 ...
 $ V38 : num  0.077 -0.105 0.3057 -0.0638 0.2352 ...
 $ V39 : num  -0.491 -0.429 -0.324 -0.167 0.29 ...
 $ V40 : num  -0.709 0.399 0.28 0.545 0.458 ...
 $ V41 : num  0.936 0.927 0.93 0.929 0.927 ...
 $ V42 : num  -0.283 -0.289 -0.288 -0.293 -0.303 ...
 $ V43 : num  0.115 0.153 0.146 0.143 0.138 ...
 $ V44 : num  -0.925 -0.989 -0.996 -0.993 -0.996 ...
 $ V45 : num  -0.937 -0.984 -0.988 -0.97 -0.971 ...
 $ V46 : num  -0.564 -0.965 -0.982 -0.992 -0.968 ...
 $ V47 : num  -0.93 -0.989 -0.996 -0.993 -0.996 ...
 $ V48 : num  -0.938 -0.983 -0.989 -0.971 -0.971 ...
 $ V49 : num  -0.606 -0.965 -0.98 -0.993 -0.969 ...
 $ V50 : num  0.906 0.856 0.856 0.856 0.854 ...
 $ V51 : num  -0.279 -0.305 -0.305 -0.305 -0.313 ...
 $ V52 : num  0.153 0.153 0.139 0.136 0.134 ...
 $ V53 : num  0.944 0.944 0.949 0.947 0.946 ...
 $ V54 : num  -0.262 -0.262 -0.262 -0.273 -0.279 ...
 $ V55 : num  -0.0762 0.149 0.145 0.1421 0.1309 ...
 $ V56 : num  -0.0178 0.0577 0.0406 0.0461 0.0554 ...
 $ V57 : num  0.829 0.806 0.812 0.809 0.804 ...
 $ V58 : num  -0.865 -0.858 -0.86 -0.854 -0.843 ...
 $ V59 : num  -0.968 -0.957 -0.961 -0.963 -0.965 ...
 $ V60 : num  -0.95 -0.988 -0.996 -0.992 -0.996 ...
 $ V61 : num  -0.946 -0.982 -0.99 -0.973 -0.972 ...
 $ V62 : num  -0.76 -0.971 -0.979 -0.996 -0.969 ...
 $ V63 : num  -0.425 -0.729 -0.823 -0.823 -0.83 ...
 $ V64 : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
 $ V65 : num  0.219 -0.465 -0.53 -0.7 -0.302 ...
 $ V66 : num  -0.43 -0.51 -0.295 -0.343 -0.482 ...
 $ V67 : num  0.431 0.525 0.305 0.359 0.539 ...
 $ V68 : num  -0.432 -0.54 -0.315 -0.375 -0.596 ...
 $ V69 : num  0.433 0.554 0.326 0.392 0.655 ...
 $ V70 : num  -0.795 -0.746 -0.232 -0.233 -0.493 ...
 $ V71 : num  0.781 0.733 0.169 0.176 0.463 ...
 $ V72 : num  -0.78 -0.737 -0.155 -0.169 -0.465 ...
 $ V73 : num  0.785 0.749 0.164 0.185 0.483 ...
 $ V74 : num  -0.984 -0.845 -0.429 -0.297 -0.536 ...
 $ V75 : num  0.987 0.869 0.44 0.304 0.544 ...
 $ V76 : num  -0.989 -0.893 -0.451 -0.311 -0.553 ...
 $ V77 : num  0.988 0.913 0.458 0.315 0.559 ...
 $ V78 : num  0.981 0.945 0.548 0.986 0.998 ...
 $ V79 : num  -0.996 -0.911 -0.335 0.653 0.916 ...
 $ V80 : num  -0.96 -0.739 0.59 0.747 0.929 ...
 $ V81 : num  0.072 0.0702 0.0694 0.0749 0.0784 ...
 $ V82 : num  0.04575 -0.01788 -0.00491 0.03227 0.02228 ...
 $ V83 : num  -0.10604 -0.00172 -0.01367 0.01214 0.00275 ...
 $ V84 : num  -0.907 -0.949 -0.991 -0.991 -0.992 ...
 $ V85 : num  -0.938 -0.973 -0.971 -0.973 -0.979 ...
 $ V86 : num  -0.936 -0.978 -0.973 -0.976 -0.987 ...
 $ V87 : num  -0.916 -0.969 -0.991 -0.99 -0.991 ...
 $ V88 : num  -0.937 -0.974 -0.973 -0.973 -0.977 ...
 $ V89 : num  -0.949 -0.979 -0.975 -0.978 -0.985 ...
 $ V90 : num  -0.903 -0.915 -0.992 -0.992 -0.994 ...
 $ V91 : num  -0.95 -0.981 -0.975 -0.975 -0.986 ...
 $ V92 : num  -0.891 -0.978 -0.962 -0.962 -0.986 ...
 $ V93 : num  0.898 0.898 0.994 0.994 0.994 ...
 $ V94 : num  0.95 0.968 0.976 0.976 0.98 ...
 $ V95 : num  0.946 0.966 0.966 0.97 0.985 ...
 $ V96 : num  -0.931 -0.974 -0.982 -0.983 -0.987 ...
 $ V97 : num  -0.995 -0.998 -1 -1 -1 ...
 $ V98 : num  -0.997 -0.999 -0.999 -0.999 -1 ...
 $ V99 : num  -0.997 -0.999 -0.999 -0.999 -1 ...
  [list output truncated]
 - attr(*, ".internal.selfref")=<externalptr> 
```

#### Specifying column names
The loaded data is labelled using the features information from the step before.

```r
setnames(data.test.x, as.character(features$feature))
```

The resulting shape is like the following

```r
str(data.test.x)
Classes ‘data.table’ and 'data.frame':	2947 obs. of  561 variables:
 $ tBodyAcc-mean()-X                   : num  0.257 0.286 0.275 0.27 0.275 ...
 $ tBodyAcc-mean()-Y                   : num  -0.0233 -0.0132 -0.0261 -0.0326 -0.0278 ...
 $ tBodyAcc-mean()-Z                   : num  -0.0147 -0.1191 -0.1182 -0.1175 -0.1295 ...
 $ tBodyAcc-std()-X                    : num  -0.938 -0.975 -0.994 -0.995 -0.994 ...
 $ tBodyAcc-std()-Y                    : num  -0.92 -0.967 -0.97 -0.973 -0.967 ...
 $ tBodyAcc-std()-Z                    : num  -0.668 -0.945 -0.963 -0.967 -0.978 ...
 $ tBodyAcc-mad()-X                    : num  -0.953 -0.987 -0.994 -0.995 -0.994 ...
 $ tBodyAcc-mad()-Y                    : num  -0.925 -0.968 -0.971 -0.974 -0.966 ...
 $ tBodyAcc-mad()-Z                    : num  -0.674 -0.946 -0.963 -0.969 -0.977 ...
 $ tBodyAcc-max()-X                    : num  -0.894 -0.894 -0.939 -0.939 -0.939 ...
 $ tBodyAcc-max()-Y                    : num  -0.555 -0.555 -0.569 -0.569 -0.561 ...
 $ tBodyAcc-max()-Z                    : num  -0.466 -0.806 -0.799 -0.799 -0.826 ...
 $ tBodyAcc-min()-X                    : num  0.717 0.768 0.848 0.848 0.849 ...
 $ tBodyAcc-min()-Y                    : num  0.636 0.684 0.668 0.668 0.671 ...
 $ tBodyAcc-min()-Z                    : num  0.789 0.797 0.822 0.822 0.83 ...
 $ tBodyAcc-sma()                      : num  -0.878 -0.969 -0.977 -0.974 -0.975 ...
 $ tBodyAcc-energy()-X                 : num  -0.998 -1 -1 -1 -1 ...
 $ tBodyAcc-energy()-Y                 : num  -0.998 -1 -1 -0.999 -0.999 ...
 $ tBodyAcc-energy()-Z                 : num  -0.934 -0.998 -0.999 -0.999 -0.999 ...
 $ tBodyAcc-iqr()-X                    : num  -0.976 -0.994 -0.993 -0.995 -0.993 ...
 $ tBodyAcc-iqr()-Y                    : num  -0.95 -0.974 -0.974 -0.979 -0.967 ...
 $ tBodyAcc-iqr()-Z                    : num  -0.83 -0.951 -0.965 -0.97 -0.976 ...
 $ tBodyAcc-entropy()-X                : num  -0.168 -0.302 -0.618 -0.75 -0.591 ...
 $ tBodyAcc-entropy()-Y                : num  -0.379 -0.348 -0.695 -0.899 -0.74 ...
 $ tBodyAcc-entropy()-Z                : num  0.246 -0.405 -0.537 -0.554 -0.799 ...
 $ tBodyAcc-arCoeff()-X,1              : num  0.521 0.507 0.242 0.175 0.116 ...
 $ tBodyAcc-arCoeff()-X,2              : num  -0.4878 -0.1565 -0.115 -0.0513 -0.0289 ...
 $ tBodyAcc-arCoeff()-X,3              : num  0.4823 0.0407 0.0327 0.0342 -0.0328 ...
 $ tBodyAcc-arCoeff()-X,4              : num  -0.0455 0.273 0.1924 0.1536 0.2943 ...
 $ tBodyAcc-arCoeff()-Y,1              : num  0.21196 0.19757 -0.01194 0.03077 0.00063 ...
 $ tBodyAcc-arCoeff()-Y,2              : num  -0.1349 -0.1946 -0.0634 -0.1293 -0.0453 ...
 $ tBodyAcc-arCoeff()-Y,3              : num  0.131 0.411 0.471 0.446 0.168 ...
 $ tBodyAcc-arCoeff()-Y,4              : num  -0.0142 -0.3405 -0.5074 -0.4195 -0.0682 ...
 $ tBodyAcc-arCoeff()-Z,1              : num  -0.106 0.0776 0.1885 0.2715 0.0744 ...
 $ tBodyAcc-arCoeff()-Z,2              : num  0.0735 -0.084 -0.2316 -0.2258 0.0271 ...
 $ tBodyAcc-arCoeff()-Z,3              : num  -0.1715 0.0353 0.6321 0.4164 -0.1459 ...
 $ tBodyAcc-arCoeff()-Z,4              : num  0.0401 -0.0101 -0.5507 -0.2864 -0.0502 ...
 $ tBodyAcc-correlation()-X,Y          : num  0.077 -0.105 0.3057 -0.0638 0.2352 ...
 $ tBodyAcc-correlation()-X,Z          : num  -0.491 -0.429 -0.324 -0.167 0.29 ...
 $ tBodyAcc-correlation()-Y,Z          : num  -0.709 0.399 0.28 0.545 0.458 ...
 $ tGravityAcc-mean()-X                : num  0.936 0.927 0.93 0.929 0.927 ...
 $ tGravityAcc-mean()-Y                : num  -0.283 -0.289 -0.288 -0.293 -0.303 ...
 $ tGravityAcc-mean()-Z                : num  0.115 0.153 0.146 0.143 0.138 ...
 $ tGravityAcc-std()-X                 : num  -0.925 -0.989 -0.996 -0.993 -0.996 ...
 $ tGravityAcc-std()-Y                 : num  -0.937 -0.984 -0.988 -0.97 -0.971 ...
 $ tGravityAcc-std()-Z                 : num  -0.564 -0.965 -0.982 -0.992 -0.968 ...
 $ tGravityAcc-mad()-X                 : num  -0.93 -0.989 -0.996 -0.993 -0.996 ...
 $ tGravityAcc-mad()-Y                 : num  -0.938 -0.983 -0.989 -0.971 -0.971 ...
 $ tGravityAcc-mad()-Z                 : num  -0.606 -0.965 -0.98 -0.993 -0.969 ...
 $ tGravityAcc-max()-X                 : num  0.906 0.856 0.856 0.856 0.854 ...
 $ tGravityAcc-max()-Y                 : num  -0.279 -0.305 -0.305 -0.305 -0.313 ...
 $ tGravityAcc-max()-Z                 : num  0.153 0.153 0.139 0.136 0.134 ...
 $ tGravityAcc-min()-X                 : num  0.944 0.944 0.949 0.947 0.946 ...
 $ tGravityAcc-min()-Y                 : num  -0.262 -0.262 -0.262 -0.273 -0.279 ...
 $ tGravityAcc-min()-Z                 : num  -0.0762 0.149 0.145 0.1421 0.1309 ...
 $ tGravityAcc-sma()                   : num  -0.0178 0.0577 0.0406 0.0461 0.0554 ...
 $ tGravityAcc-energy()-X              : num  0.829 0.806 0.812 0.809 0.804 ...
 $ tGravityAcc-energy()-Y              : num  -0.865 -0.858 -0.86 -0.854 -0.843 ...
 $ tGravityAcc-energy()-Z              : num  -0.968 -0.957 -0.961 -0.963 -0.965 ...
 $ tGravityAcc-iqr()-X                 : num  -0.95 -0.988 -0.996 -0.992 -0.996 ...
 $ tGravityAcc-iqr()-Y                 : num  -0.946 -0.982 -0.99 -0.973 -0.972 ...
 $ tGravityAcc-iqr()-Z                 : num  -0.76 -0.971 -0.979 -0.996 -0.969 ...
 $ tGravityAcc-entropy()-X             : num  -0.425 -0.729 -0.823 -0.823 -0.83 ...
 $ tGravityAcc-entropy()-Y             : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
 $ tGravityAcc-entropy()-Z             : num  0.219 -0.465 -0.53 -0.7 -0.302 ...
 $ tGravityAcc-arCoeff()-X,1           : num  -0.43 -0.51 -0.295 -0.343 -0.482 ...
 $ tGravityAcc-arCoeff()-X,2           : num  0.431 0.525 0.305 0.359 0.539 ...
 $ tGravityAcc-arCoeff()-X,3           : num  -0.432 -0.54 -0.315 -0.375 -0.596 ...
 $ tGravityAcc-arCoeff()-X,4           : num  0.433 0.554 0.326 0.392 0.655 ...
 $ tGravityAcc-arCoeff()-Y,1           : num  -0.795 -0.746 -0.232 -0.233 -0.493 ...
 $ tGravityAcc-arCoeff()-Y,2           : num  0.781 0.733 0.169 0.176 0.463 ...
 $ tGravityAcc-arCoeff()-Y,3           : num  -0.78 -0.737 -0.155 -0.169 -0.465 ...
 $ tGravityAcc-arCoeff()-Y,4           : num  0.785 0.749 0.164 0.185 0.483 ...
 $ tGravityAcc-arCoeff()-Z,1           : num  -0.984 -0.845 -0.429 -0.297 -0.536 ...
 $ tGravityAcc-arCoeff()-Z,2           : num  0.987 0.869 0.44 0.304 0.544 ...
 $ tGravityAcc-arCoeff()-Z,3           : num  -0.989 -0.893 -0.451 -0.311 -0.553 ...
 $ tGravityAcc-arCoeff()-Z,4           : num  0.988 0.913 0.458 0.315 0.559 ...
 $ tGravityAcc-correlation()-X,Y       : num  0.981 0.945 0.548 0.986 0.998 ...
 $ tGravityAcc-correlation()-X,Z       : num  -0.996 -0.911 -0.335 0.653 0.916 ...
 $ tGravityAcc-correlation()-Y,Z       : num  -0.96 -0.739 0.59 0.747 0.929 ...
 $ tBodyAccJerk-mean()-X               : num  0.072 0.0702 0.0694 0.0749 0.0784 ...
 $ tBodyAccJerk-mean()-Y               : num  0.04575 -0.01788 -0.00491 0.03227 0.02228 ...
 $ tBodyAccJerk-mean()-Z               : num  -0.10604 -0.00172 -0.01367 0.01214 0.00275 ...
 $ tBodyAccJerk-std()-X                : num  -0.907 -0.949 -0.991 -0.991 -0.992 ...
 $ tBodyAccJerk-std()-Y                : num  -0.938 -0.973 -0.971 -0.973 -0.979 ...
 $ tBodyAccJerk-std()-Z                : num  -0.936 -0.978 -0.973 -0.976 -0.987 ...
 $ tBodyAccJerk-mad()-X                : num  -0.916 -0.969 -0.991 -0.99 -0.991 ...
 $ tBodyAccJerk-mad()-Y                : num  -0.937 -0.974 -0.973 -0.973 -0.977 ...
 $ tBodyAccJerk-mad()-Z                : num  -0.949 -0.979 -0.975 -0.978 -0.985 ...
 $ tBodyAccJerk-max()-X                : num  -0.903 -0.915 -0.992 -0.992 -0.994 ...
 $ tBodyAccJerk-max()-Y                : num  -0.95 -0.981 -0.975 -0.975 -0.986 ...
 $ tBodyAccJerk-max()-Z                : num  -0.891 -0.978 -0.962 -0.962 -0.986 ...
 $ tBodyAccJerk-min()-X                : num  0.898 0.898 0.994 0.994 0.994 ...
 $ tBodyAccJerk-min()-Y                : num  0.95 0.968 0.976 0.976 0.98 ...
 $ tBodyAccJerk-min()-Z                : num  0.946 0.966 0.966 0.97 0.985 ...
 $ tBodyAccJerk-sma()                  : num  -0.931 -0.974 -0.982 -0.983 -0.987 ...
 $ tBodyAccJerk-energy()-X             : num  -0.995 -0.998 -1 -1 -1 ...
 $ tBodyAccJerk-energy()-Y             : num  -0.997 -0.999 -0.999 -0.999 -1 ...
 $ tBodyAccJerk-energy()-Z             : num  -0.997 -0.999 -0.999 -0.999 -1 ...
  [list output truncated]
 - attr(*, ".internal.selfref")=<externalptr> 
```


#### Reading activities

Reading the activities describing the actual activity per record 

```r
data.test.y <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/test/y_test.txt")))
```

The raw structure is shown below
```r
str(data.test.y)
Classes ‘data.table’ and 'data.frame':	2947 obs. of  1 variable:
 $ V1: int  5 5 5 5 5 5 5 5 5 5 ...
 - attr(*, ".internal.selfref")=<externalptr>
```

To make it more readable, lets provide a readable name

```r
setnames(data.test.y, "activity_id")
```

#### Reading subjects

The last step per raw part is obtaining the subject information, describing who was performing the actual
operation per record.

```r
data.test.subject <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/test/subject_test.txt")))
```

Also here we need to have readable names
```r
setnames(data.test.subject,"subject")
```

The resulting shape is the following

```r
str(data.test.subject)
Classes ‘data.table’ and 'data.frame':	2947 obs. of  1 variable:
 $ subject: int  2 2 2 2 2 2 2 2 2 2 ...
 - attr(*, ".internal.selfref")=<externalptr> 
```

#### Binding columns for the test dataset

The obtained information should now be merged into one test dataset.

```r
data.test <- cbind(data.test.x, data.test.y)
data.test <- cbind(data.test, data.test.subject)
```

The result looks like the following. Note the activity and subject columns are bound to the end of the columns

```r
str(data.test)

Classes ‘data.table’ and 'data.frame':	2947 obs. of  563 variables:
 $ tBodyAcc-mean()-X                   : num  0.257 0.286 0.275 0.27 0.275 ...
 $ tBodyAcc-mean()-Y                   : num  -0.0233 -0.0132 -0.0261 -0.0326 -0.0278 ...
 $ tBodyAcc-mean()-Z                   : num  -0.0147 -0.1191 -0.1182 -0.1175 -0.1295 ...
 $ tBodyAcc-std()-X                    : num  -0.938 -0.975 -0.994 -0.995 -0.994 ...
 $ tBodyAcc-std()-Y                    : num  -0.92 -0.967 -0.97 -0.973 -0.967 ...
 $ tBodyAcc-std()-Z                    : num  -0.668 -0.945 -0.963 -0.967 -0.978 ...
 $ tBodyAcc-mad()-X                    : num  -0.953 -0.987 -0.994 -0.995 -0.994 ...
 $ tBodyAcc-mad()-Y                    : num  -0.925 -0.968 -0.971 -0.974 -0.966 ...
 $ tBodyAcc-mad()-Z                    : num  -0.674 -0.946 -0.963 -0.969 -0.977 ...
 $ tBodyAcc-max()-X                    : num  -0.894 -0.894 -0.939 -0.939 -0.939 ...
 $ tBodyAcc-max()-Y                    : num  -0.555 -0.555 -0.569 -0.569 -0.561 ...
 $ tBodyAcc-max()-Z                    : num  -0.466 -0.806 -0.799 -0.799 -0.826 ...
 $ tBodyAcc-min()-X                    : num  0.717 0.768 0.848 0.848 0.849 ...
 $ tBodyAcc-min()-Y                    : num  0.636 0.684 0.668 0.668 0.671 ...
 $ tBodyAcc-min()-Z                    : num  0.789 0.797 0.822 0.822 0.83 ...
 $ tBodyAcc-sma()                      : num  -0.878 -0.969 -0.977 -0.974 -0.975 ...
 $ tBodyAcc-energy()-X                 : num  -0.998 -1 -1 -1 -1 ...
 $ tBodyAcc-energy()-Y                 : num  -0.998 -1 -1 -0.999 -0.999 ...
 $ tBodyAcc-energy()-Z                 : num  -0.934 -0.998 -0.999 -0.999 -0.999 ...
 $ tBodyAcc-iqr()-X                    : num  -0.976 -0.994 -0.993 -0.995 -0.993 ...
 $ tBodyAcc-iqr()-Y                    : num  -0.95 -0.974 -0.974 -0.979 -0.967 ...
 $ tBodyAcc-iqr()-Z                    : num  -0.83 -0.951 -0.965 -0.97 -0.976 ...
 $ tBodyAcc-entropy()-X                : num  -0.168 -0.302 -0.618 -0.75 -0.591 ...
 $ tBodyAcc-entropy()-Y                : num  -0.379 -0.348 -0.695 -0.899 -0.74 ...
 $ tBodyAcc-entropy()-Z                : num  0.246 -0.405 -0.537 -0.554 -0.799 ...
 $ tBodyAcc-arCoeff()-X,1              : num  0.521 0.507 0.242 0.175 0.116 ...
 $ tBodyAcc-arCoeff()-X,2              : num  -0.4878 -0.1565 -0.115 -0.0513 -0.0289 ...
 $ tBodyAcc-arCoeff()-X,3              : num  0.4823 0.0407 0.0327 0.0342 -0.0328 ...
 $ tBodyAcc-arCoeff()-X,4              : num  -0.0455 0.273 0.1924 0.1536 0.2943 ...
 $ tBodyAcc-arCoeff()-Y,1              : num  0.21196 0.19757 -0.01194 0.03077 0.00063 ...
 $ tBodyAcc-arCoeff()-Y,2              : num  -0.1349 -0.1946 -0.0634 -0.1293 -0.0453 ...
 $ tBodyAcc-arCoeff()-Y,3              : num  0.131 0.411 0.471 0.446 0.168 ...
 $ tBodyAcc-arCoeff()-Y,4              : num  -0.0142 -0.3405 -0.5074 -0.4195 -0.0682 ...
 $ tBodyAcc-arCoeff()-Z,1              : num  -0.106 0.0776 0.1885 0.2715 0.0744 ...
 $ tBodyAcc-arCoeff()-Z,2              : num  0.0735 -0.084 -0.2316 -0.2258 0.0271 ...
 $ tBodyAcc-arCoeff()-Z,3              : num  -0.1715 0.0353 0.6321 0.4164 -0.1459 ...
 $ tBodyAcc-arCoeff()-Z,4              : num  0.0401 -0.0101 -0.5507 -0.2864 -0.0502 ...
 $ tBodyAcc-correlation()-X,Y          : num  0.077 -0.105 0.3057 -0.0638 0.2352 ...
 $ tBodyAcc-correlation()-X,Z          : num  -0.491 -0.429 -0.324 -0.167 0.29 ...
 $ tBodyAcc-correlation()-Y,Z          : num  -0.709 0.399 0.28 0.545 0.458 ...
 $ tGravityAcc-mean()-X                : num  0.936 0.927 0.93 0.929 0.927 ...
 $ tGravityAcc-mean()-Y                : num  -0.283 -0.289 -0.288 -0.293 -0.303 ...
 $ tGravityAcc-mean()-Z                : num  0.115 0.153 0.146 0.143 0.138 ...
 $ tGravityAcc-std()-X                 : num  -0.925 -0.989 -0.996 -0.993 -0.996 ...
 $ tGravityAcc-std()-Y                 : num  -0.937 -0.984 -0.988 -0.97 -0.971 ...
 $ tGravityAcc-std()-Z                 : num  -0.564 -0.965 -0.982 -0.992 -0.968 ...
 $ tGravityAcc-mad()-X                 : num  -0.93 -0.989 -0.996 -0.993 -0.996 ...
 $ tGravityAcc-mad()-Y                 : num  -0.938 -0.983 -0.989 -0.971 -0.971 ...
 $ tGravityAcc-mad()-Z                 : num  -0.606 -0.965 -0.98 -0.993 -0.969 ...
 $ tGravityAcc-max()-X                 : num  0.906 0.856 0.856 0.856 0.854 ...
 $ tGravityAcc-max()-Y                 : num  -0.279 -0.305 -0.305 -0.305 -0.313 ...
 $ tGravityAcc-max()-Z                 : num  0.153 0.153 0.139 0.136 0.134 ...
 $ tGravityAcc-min()-X                 : num  0.944 0.944 0.949 0.947 0.946 ...
 $ tGravityAcc-min()-Y                 : num  -0.262 -0.262 -0.262 -0.273 -0.279 ...
 $ tGravityAcc-min()-Z                 : num  -0.0762 0.149 0.145 0.1421 0.1309 ...
 $ tGravityAcc-sma()                   : num  -0.0178 0.0577 0.0406 0.0461 0.0554 ...
 $ tGravityAcc-energy()-X              : num  0.829 0.806 0.812 0.809 0.804 ...
 $ tGravityAcc-energy()-Y              : num  -0.865 -0.858 -0.86 -0.854 -0.843 ...
 $ tGravityAcc-energy()-Z              : num  -0.968 -0.957 -0.961 -0.963 -0.965 ...
 $ tGravityAcc-iqr()-X                 : num  -0.95 -0.988 -0.996 -0.992 -0.996 ...
 $ tGravityAcc-iqr()-Y                 : num  -0.946 -0.982 -0.99 -0.973 -0.972 ...
 $ tGravityAcc-iqr()-Z                 : num  -0.76 -0.971 -0.979 -0.996 -0.969 ...
 $ tGravityAcc-entropy()-X             : num  -0.425 -0.729 -0.823 -0.823 -0.83 ...
 $ tGravityAcc-entropy()-Y             : num  -1 -1 -1 -1 -1 -1 -1 -1 -1 -1 ...
 $ tGravityAcc-entropy()-Z             : num  0.219 -0.465 -0.53 -0.7 -0.302 ...
 $ tGravityAcc-arCoeff()-X,1           : num  -0.43 -0.51 -0.295 -0.343 -0.482 ...
 $ tGravityAcc-arCoeff()-X,2           : num  0.431 0.525 0.305 0.359 0.539 ...
 $ tGravityAcc-arCoeff()-X,3           : num  -0.432 -0.54 -0.315 -0.375 -0.596 ...
 $ tGravityAcc-arCoeff()-X,4           : num  0.433 0.554 0.326 0.392 0.655 ...
 $ tGravityAcc-arCoeff()-Y,1           : num  -0.795 -0.746 -0.232 -0.233 -0.493 ...
 $ tGravityAcc-arCoeff()-Y,2           : num  0.781 0.733 0.169 0.176 0.463 ...
 $ tGravityAcc-arCoeff()-Y,3           : num  -0.78 -0.737 -0.155 -0.169 -0.465 ...
 $ tGravityAcc-arCoeff()-Y,4           : num  0.785 0.749 0.164 0.185 0.483 ...
 $ tGravityAcc-arCoeff()-Z,1           : num  -0.984 -0.845 -0.429 -0.297 -0.536 ...
 $ tGravityAcc-arCoeff()-Z,2           : num  0.987 0.869 0.44 0.304 0.544 ...
 $ tGravityAcc-arCoeff()-Z,3           : num  -0.989 -0.893 -0.451 -0.311 -0.553 ...
 $ tGravityAcc-arCoeff()-Z,4           : num  0.988 0.913 0.458 0.315 0.559 ...
 $ tGravityAcc-correlation()-X,Y       : num  0.981 0.945 0.548 0.986 0.998 ...
 $ tGravityAcc-correlation()-X,Z       : num  -0.996 -0.911 -0.335 0.653 0.916 ...
 $ tGravityAcc-correlation()-Y,Z       : num  -0.96 -0.739 0.59 0.747 0.929 ...
 $ tBodyAccJerk-mean()-X               : num  0.072 0.0702 0.0694 0.0749 0.0784 ...
 $ tBodyAccJerk-mean()-Y               : num  0.04575 -0.01788 -0.00491 0.03227 0.02228 ...
 $ tBodyAccJerk-mean()-Z               : num  -0.10604 -0.00172 -0.01367 0.01214 0.00275 ...
 $ tBodyAccJerk-std()-X                : num  -0.907 -0.949 -0.991 -0.991 -0.992 ...
 $ tBodyAccJerk-std()-Y                : num  -0.938 -0.973 -0.971 -0.973 -0.979 ...
 $ tBodyAccJerk-std()-Z                : num  -0.936 -0.978 -0.973 -0.976 -0.987 ...
 $ tBodyAccJerk-mad()-X                : num  -0.916 -0.969 -0.991 -0.99 -0.991 ...
 $ tBodyAccJerk-mad()-Y                : num  -0.937 -0.974 -0.973 -0.973 -0.977 ...
 $ tBodyAccJerk-mad()-Z                : num  -0.949 -0.979 -0.975 -0.978 -0.985 ...
 $ tBodyAccJerk-max()-X                : num  -0.903 -0.915 -0.992 -0.992 -0.994 ...
 $ tBodyAccJerk-max()-Y                : num  -0.95 -0.981 -0.975 -0.975 -0.986 ...
 $ tBodyAccJerk-max()-Z                : num  -0.891 -0.978 -0.962 -0.962 -0.986 ...
 $ tBodyAccJerk-min()-X                : num  0.898 0.898 0.994 0.994 0.994 ...
 $ tBodyAccJerk-min()-Y                : num  0.95 0.968 0.976 0.976 0.98 ...
 $ tBodyAccJerk-min()-Z                : num  0.946 0.966 0.966 0.97 0.985 ...
 $ tBodyAccJerk-sma()                  : num  -0.931 -0.974 -0.982 -0.983 -0.987 ...
 $ tBodyAccJerk-energy()-X             : num  -0.995 -0.998 -1 -1 -1 ...
 $ tBodyAccJerk-energy()-Y             : num  -0.997 -0.999 -0.999 -0.999 -1 ...
 $ tBodyAccJerk-energy()-Z             : num  -0.997 -0.999 -0.999 -0.999 -1 ...
  [list output truncated]
 - attr(*, ".internal.selfref")=<externalptr> 
 
 
 tail(names(date.test))
 [1] "angle(tBodyGyroJerkMean,gravityMean)" "angle(X,gravityMean)"                
[3] "angle(Y,gravityMean)"                 "angle(Z,gravityMean)"                
[5] "activity_id"                          "subject"  
```

#### Release unused memory

TO save some memory, we are releasing the unused variables and will continue only with the ones we need.

```r
rm(data.test.x)
rm(data.test.y)
rm(data.test.subject)
```

### train data

#### reading measurements
data.train.x <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/train/X_train.txt")))

#### specifying column names
setnames(data.train.x, as.character(features$feature))

#### reading activities
data.train.y <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/train/y_train.txt")))
setnames(data.train.y, "activity_id")

#### reading subjects
data.train.subject <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/train/subject_train.txt")))
setnames(data.train.subject,"subject")

#### bind columns
data.train <- cbind(data.train.x, data.train.y)
data.train <- cbind(data.train, data.train.subject)

#### release unused memory
rm(data.train.x)
rm(data.train.y)
rm(data.train.subject)
rm(features)


#### merge datasets together
print("merging data")
l <- list(data.test, data.train)
data.merged <- rbindlist(l, use.names=TRUE, fill=TRUE)


#### free some memory
rm(l)
rm(data.train)
rm(data.test)

### 2. Extracts only the measurements on the mean and standard deviation for each measurement. 

print("extracting needed columns")

data <- data.merged[, grep("std|mean|activity|subject", names(data.merged)), with=FALSE]
rm(data.merged)

### 3. Uses descriptive activity names to name the activities in the data set

print("labelling activities")
#### obtain activiy labels
activities <- data.table(read.table(unz(zippedDataset, "UCI HAR Dataset/activity_labels.txt"), 
                                  col.names=c("activity_id", "activity"), 
                                  stringsAsFactors=FALSE))

#### label avtivities by merging
data <- merge(data, activities, by="activity_id", all=TRUE)
data[, activity_id := NULL]

#### cleaning up activities
rm(activities)
rm(zippedDataset)

### 4. Appropriately labels the data set with descriptive variable names. 

print("cleaning up variable names")
names(data)<-gsub("^t", "time", names(data))
names(data)<-gsub("^f", "frequency", names(data))
names(data)<-gsub("Acc", "Accelerometer", names(data))
names(data)<-gsub("Gyro", "Gyroscope", names(data))
names(data)<-gsub("Mag", "Magnitude", names(data))
names(data)<-gsub("BodyBody", "Body", names(data))

### 5. From the data set in step 4, creates a second, independent tidy data set with the 
###     average of each variable for each activity and each subject.

print("generating a second set for writing")

data.melt <- melt(data, id=c("activity", "subject"))
data.tidy <- dcast(data.melt, activity + subject ~ variable, mean)

rm(data)
rm(data.melt)

print("writing to output")
#### finally write a txt file
write.table(data.tidy, "tidyData.txt", row.name = FALSE)

rm(data.tidy)

